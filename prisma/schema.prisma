generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  id            Int       @id @default(autoincrement())
  first_name    String    @db.VarChar(45)
  last_name     String    @db.VarChar(45)
  email         String    @unique @db.VarChar(65)
  password_hash String    @unique @db.VarChar(200)
  tag           String    @unique @db.VarChar(45)
  last_login    DateTime
  status        Int
  image_url     String?   @db.VarChar(45)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @default(now())

  projects        projects[]
  tasks           tasks[]
  invitesSent     invites[] @relation("invites_invitedBy")
  invitesReceived invites[] @relation("invites_invitedUser")
  project_members project_members[]
  member_permissions member_permissions[]
}

model projects {
  id          Int      @id @default(autoincrement())
  owner_id    Int
  title       String  @db.VarChar(60)
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())

  owner users @relation(fields: [owner_id], references: [id])

  tasks              tasks[]
  invites            invites[]
  project_members    project_members[]
  member_permissions member_permissions[]

  @@index([owner_id])
}

model invites {
  id             Int      @id @default(autoincrement())
  project_id     Int
  invitedUser_id Int
  invitedBy_id   Int
  status         Int
  description    String?
  accepted_at    DateTime
  created_at     DateTime @default(now())
  updated_at     DateTime @default(now())

  project     projects @relation(fields: [project_id], references: [id])
  invitedUser users    @relation("invites_invitedUser", fields: [invitedUser_id], references: [id])
  invitedBy   users    @relation("invites_invitedBy", fields: [invitedBy_id], references: [id])

  @@index([project_id])
  @@index([invitedUser_id])
  @@index([invitedBy_id])
}

model roles {
  id         Int      @id @default(autoincrement())
  role       String   @db.VarChar(45)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  project_members project_members[]
}

model permissions {
  id         Int      @id @default(autoincrement())
  key        String   @db.VarChar(45)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  member_permissions member_permissions[]
}

model project_members {
  project_id Int
  user_id    Int
  role_id    Int
  joined_at  DateTime @default(now())
  updated_at DateTime @default(now())

  project projects @relation(fields: [project_id], references: [id])
  user    users    @relation(fields: [user_id], references: [id])
  role    roles    @relation(fields: [role_id], references: [id])

  @@id([project_id, user_id])
  @@index([role_id])
  @@index([user_id])
}

model member_permissions {
  project_id    Int
  user_id       Int
  permission_id Int

  project    projects    @relation(fields: [project_id], references: [id])
  user       users       @relation(fields: [user_id], references: [id])
  permission permissions @relation(fields: [permission_id], references: [id])

  @@id([project_id, user_id, permission_id])
  @@index([permission_id])
  @@index([user_id])
}

model priority_status {
  id         Int      @id @default(autoincrement())
  status     String   @db.VarChar(45)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  tasks tasks[]
}

model status {
  id         Int      @id @default(autoincrement())
  status     String   @db.VarChar(45)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  tasks tasks[]
}

model tasks {
  id          Int      @id @default(autoincrement())
  user_id     Int
  project_id  Int
  status_id   Int
  priority_id Int
  title       String   @db.VarChar(100)
  description String   @db.Text
  dueDate     DateTime?
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())

  user     users           @relation(fields: [user_id], references: [id])
  project  projects        @relation(fields: [project_id], references: [id])
  status   status          @relation(fields: [status_id], references: [id])
  priority priority_status @relation(fields: [priority_id], references: [id])

  subtasks subtasks[]

  @@index([user_id])
  @@index([project_id])
  @@index([status_id])
  @@index([priority_id])
}

model subtasks {
  id          Int      @id @default(autoincrement())
  task_id     Int
  title       String   @db.VarChar(65)
  description String?
  status      Int
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())

  task tasks @relation(fields: [task_id], references: [id])

  @@index([task_id])
}
